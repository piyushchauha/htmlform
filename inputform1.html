<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Input form1</title>
  </head>
  <body>
    <div id="header"></div>
    <div id="fieldcontainer"></div>
    <div id="optioncontainer"></div>
    <div id="createcontainer"></div>
    <div id="inputcontainer"></div>
    <div id="submitcontainer"></div>
    <div id="displaytable"></div>
  </body>
  <script>
    let selectedvalue = "";
    let table = document.createElement("table");
    table.style.border = "1px solid black";
    let tbody = document.createElement("tbody");
    let currentoptions = [];
    let main = [];

    let inputattribute = {};
    let myobject = [];
    let valoption = [];

    let eindex = "";

    let selectdata = [
      {
        label: "Select the input",
        id: "inputselect",
        type: "dropdown",
        options: [
          { label: "Select the input", value: "", id: "select" },
          { label: "text", id: "texte", type: "text", value: "text" },
          { label: "tel", id: "tele", type: "tel", value: "tel" },
          { label: "email", id: "emaile", type: "email", value: "email" },
          {
            label: "password",
            id: "passe",
            type: "password",
            value: "password",
          },
          {
            label: "Radio",
            id: "radio",
            type: "radio",
            value: "radio",
          },
          {
            label: "checkbox",
            id: "checkbox",
            type: "checkbox",
            value: "checkbox",
          },
          {
            label: "dropdown",
            id: "dropdown",
            type: "dropdown",
            value: "dropdown",
          },
        ],
      },
    ];

    let attributedata = [
      {
        label: "Name",
        type: "text",
        inf: "name",
      },
      {
        label: "Value",
        type: "text",
        inf: "value",
      },
      {
        label: "Id",
        type: "text",
        inf: "id",
      },
    ];

    function createinput() {
      for (i = 0; i < selectdata.length; i++) {
        let select = document.createElement("select");
        select.setAttribute("id", selectdata[i].id);
        header.append(select);
        for (j = 0; j < selectdata[i].options.length; j++) {
          let options = document.createElement("option");
          options.setAttribute("value", selectdata[i].options[j].value);
          options.setAttribute("id", selectdata[i].options[j].id);
          options.innerHTML = selectdata[i].options[j].label;
          select.append(options);
        }

        select.addEventListener("change", fieldcreation);
      }
    }

    function fieldcreation() {
      fieldcontainer.innerHTML = "";
      createcontainer.innerHTML = "";

      selectedvalue = document.getElementById("inputselect").value;

      for (i = 0; i < attributedata.length; i++) {
        let label = document.createElement("label");
        label.innerHTML = attributedata[i].label + "<br>";

        let input = document.createElement("input");

        input.setAttribute(attributedata[i].type, "text");
        input.setAttribute("id", attributedata[i].inf);

        fieldcontainer.append(label);
        fieldcontainer.append(input);
        fieldcontainer.append(document.createElement("br"));
      }

      if (
        selectedvalue == "radio" ||
        selectedvalue == "checkbox" ||
        selectedvalue == "dropdown"
      ) {
        optiontextcreation();
      }

      let createbtn = document.createElement("button");
      createbtn.innerHTML = "Create";
      createbtn.style.margin = "20px";
      createcontainer.append(createbtn);
      createbtn.addEventListener("click", getFieldsValue);
    }

    function optiontextcreation() {
      let addbtn = document.createElement("button");
      addbtn.style.marginTop = "15px";
      addbtn.innerHTML = "Add Options";

      fieldcontainer.append(addbtn);

      addbtn.addEventListener("click", () => {
        const optioncontainer = document.getElementById("optioncontainer");
        const children = optioncontainer.children.length;

        let inputoption = document.createElement("input");
        inputoption.setAttribute("type", "text");
        inputoption.setAttribute("placeholder", "Enter the options");

        let index = children + 1;
        inputoption.id = `option${index}`;

        optioncontainer.append(inputoption);
        valoption.push(inputoption);
      });
    }

    function getFieldsValue() {
      console.log("getFieldsValue");
      inputattribute = {};
      currentoptions = [];

      for (i = 0; i < attributedata.length; i++) {
        let att = attributedata[i].inf;
        let val = document.getElementById(att).value;
        inputattribute[att] = val;
      }
      inputattribute.type = selectedvalue;

      for (i = 0; i < valoption.length; i++) {
        let optionvalue = valoption[i].value;
        currentoptions.push(optionvalue);
      }

      if (
        selectedvalue == "radio" ||
        selectedvalue == "dropdown" ||
        selectedvalue == "checkbox"
      ) {
        inputattribute.options = currentoptions;
      }

      myobject.push(inputattribute);
      console.log(myobject);
      createfield();
    }
    function createfield() {
      submitcontainer.innerHTML = "";
      let name = document.getElementById("name").value;
      let id = document.getElementById("id").value;
      let label = document.createElement("label");
      label.setAttribute("for", name);
      label.innerHTML = name;
      inputcontainer.append(document.createElement("br"));
      inputcontainer.append(label);

      if (
        selectedvalue == "radio" ||
        selectedvalue == "dropdown" ||
        selectedvalue == "checkbox"
      ) {
        inputcontainer.append(document.createElement("br"));
        optioncreation();
      } else {
        let newinput = document.createElement("input");

        newinput.type = selectedvalue;
        newinput.id = id;
        inputcontainer.append(newinput);
      }

      document.getElementById("name").value = "";
      document.getElementById("id").value = "";
      document.getElementById("value").value = "";

      let subbtn = document.createElement("button");
      subbtn.innerHTML = "Submit";
      subbtn.style.margin = "20px";
      subbtn.addEventListener("click", createtable);
      submitcontainer.append(subbtn);
    }

    function optioncreation() {
      if (selectedvalue == "radio" || selectedvalue == "checkbox") {
        const name = document.getElementById("name").value;

        for (let i = 0; i < currentoptions.length; i++) {
          const input = document.createElement("input");
          input.type = selectedvalue;
          input.value = currentoptions[i];
          input.name = name;
          input.id = currentoptions[i];

          let label = document.createElement("label");
          label.setAttribute("for", input.id);
          label.textContent = currentoptions[i];

          inputcontainer.append(input);
          inputcontainer.append(label);
          inputcontainer.append(document.createElement("br"));
        }
      } else if (selectedvalue == "dropdown") {
        const name = document.getElementById("name").value;
        const select = document.createElement("select");
        select.name = name;
        select.id = name;
        for (let i = 0; i < currentoptions.length; i++) {
          const options = document.createElement("option");
          options.value = currentoptions[i];
          options.innerHTML = currentoptions[i];
          select.append(options);
        }
        inputcontainer.append(select);
        inputcontainer.append(document.createElement("br"));
      }
      valoption = [];
      document.getElementById("optioncontainer").innerHTML = "";
    }

    function clearfields() {
      let input = inputcontainer.children;

      for (let i = 0; i < input.length; i++) {
        let ele = input[i];
        if (ele.type === "radio" || ele.type === "checkbox") {
          ele.checked = false;
        } else if (ele.type === "dropdown") {
          ele.selected = false;
        } else {
          ele.value = "";
        }
      }
    }

    function createtable() {
      table.innerHTML = "";
      tbody.innerHTML = "";
      let thead = document.createElement("thead");
      for (let i = 0; i < myobject.length; i++) {
        let th = document.createElement("th");

        th.innerHTML = myobject[i].name;
        th.style.border = "1px solid black";
        thead.append(th);
        table.append(thead);
        table.append(tbody);
      }
      let th1 = document.createElement("th");
      th1.innerHTML = "Actions";
      th1.style.border = "1px solid black";
      thead.append(th1);
      displaytable.append(table);

      triggertable();
      clearfields();
    }
    function triggertable() {
      let inputdata = {};
      let val = "";
      for (i = 0; i < myobject.length; i++) {
        const { id, name, type } = myobject[i];
        console.log(myobject[i]);

        if (type === "radio") {
          const radio = document.getElementsByName(name);
          for (j = 0; j < radio.length; j++) {
            if (radio[j].checked) {
              val = radio[j].value;
            }
          }
        } else if (type === "checkbox") {
          const checkbox = document.getElementsByName(name);
          let selected = [];
          for (j = 0; j < checkbox.length; j++) {
            if (checkbox[j].checked) {
              selected.push(checkbox[j].value);
            }
          }
          val = selected;
        } else if (type === "dropdown") {
          const dropdown = document.getElementById(id);
          if (dropdown) {
            val = dropdown.value;
          }
        } else {
          const input = document.getElementById(id);
          val = input.value;
        }
        inputdata[id] = val;
      }
      if (eindex === "") {
        main.push(inputdata);
      } else {
        main[eindex] = inputdata;
        eindex = "";
      }
      console.log("this", inputdata);
      console.log("main", main);
      for (let i = 0; i < main.length; i++) {
        let tr = document.createElement("tr");
        let tr1 = document.createElement("tr");
        const keys = Object.keys(main[i]);
        for (let j = 0; j < keys.length; j++) {
          let td = document.createElement("td");
          td.style.border = "1px solid black";
          td.innerHTML = main[i][keys[j]];
          tr.append(td);
          tbody.append(tr);
        }
        let editbtn = document.createElement("button");
        editbtn.innerHTML = "Edit";
        editbtn.addEventListener("click", () => editrow(i));
        let deletebtn = document.createElement("button");
        deletebtn.innerHTML = "Delete";
        deletebtn.addEventListener("click", () => deleterow(i, tr));
        editbtn.style.marginRight = "5px";
        let td1 = document.createElement("td");
        td1.append(editbtn);
        td1.append(deletebtn);
        tr.append(td1);
      }
      table.append(tbody);
    }

    function deleterow(ind, row) {
      main.splice(ind, 1);
      row.remove();
    }

    function editrow(ind) {
      let editdata = main[ind];
      eindex = ind;
      for (let i = 0; i < myobject.length; i++) {
        const field = myobject[i];
        const { name, id, type } = field;

        if (type === "radio") {
          const radio = document.getElementsByName(name);
          for (let j = 0; j < radio.length; j++) {
            if (radio[j].value === editdata[id]) {
              radio[j].checked = true;
            } else {
              radio[j].checked = false;
            }
          }
        } else if (type === "checkbox") {
          const checkbox = document.getElementsByName(name);
          for (let j = 0; j < checkbox.length; j++) {
            let val = checkbox[j].value;
            if (val.includes(editdata[id])) {
              checkbox[j].checked = true;
            } else {
              checkbox[j].checked = false;
            }
          }
        } else if (type === "dropdown") {
          const dropdown = document.getElementById(id);
          if (dropdown) {
            dropdown.value = editdata[id];
          }
        } else {
          const input = document.getElementById(id);
          input.value = editdata[id];
        }
      }
    }
    createinput();
  </script>
</html>
