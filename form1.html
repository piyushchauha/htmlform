<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form1</title>
  </head>
  <body>
    <div class="maincontainer">
      <div class="subcontainer">
        <form id="form1"></form>
        <div id="displaytable"></div>
      </div>
    </div>
  </body>
  <script>
    let data = [
      // {
      //   name: "Piyush Chauhan",
      //   email: "cp262329@gmail.com",
      //   contact: "0123456789",
      //   gender: "male",
      //   hobby: "gym,music",
      //   city: "ahmedabad",
      //   password: "1234567890",
      //   submitbtn: "",
      // },
      // {
      //   name: "king",
      //   email: "king@gmail.com",
      //   contact: "01234567",
      //   gender: "female",
      //   hobby: "gym,",
      //   city: "rajkot",
      //   password: "5678",
      //   submitbtn: "",
      // },
    ];
    let eindex = "";
    let form = document.getElementById("form1");
    let table = document.createElement("table");
    let tbody = document.createElement("tbody");
    let sub = document.createElement("button");

    const datainput = [
      { label: "Name", id: "name", type: "text" },
      { label: "Email", id: "email", type: "email" },
      { label: "Contact", id: "contact", type: "tel" },
      {
        label: "Gender:",
        id: "gender",
        type: "radio",
        options: [
          { label: "Male", value: "male", name: "gender", id: "male" },
          { label: "Female", value: "female", name: "gender", id: "female" },
        ],
      },
      {
        label: "Hobby",
        id: "hobby",
        type: "checkbox",
        options: [
          { label: "Gym", value: "gym", name: "hobby", id: "gym" },
          { label: "Music", value: "music", name: "hobby", id: "music" },
          { label: "Dance", value: "dance", name: "hobby", id: "dance" },
        ],
      },
      {
        label: "City",
        id: "city",
        type: "dropdown",
        options: [
          { label: "select city", value: "", name: "city", id: "selectcity" },
          {
            label: "Ahmedabad",
            value: "ahmedabad",
            name: "city",
            id: "ahmedabad",
          },
          { label: "Rajkot", value: "rajkot", name: "city", id: "rajkot" },
          { label: "Baroda", value: "baroda", name: "city", id: "baroda" },
        ],
      },
      { label: "Password", id: "password", type: "password" },
      { label: "", id: "submitbtn", type: "submit" },
      {
        label: "Actions",
        id: "actions",
      },
    ];

    // function createform() {
    //   for (i = 0; i < datainput.length; i++) {
    //     if (datainput[i].label == "Actions") {
    //       continue;
    //     }
    //     let label = document.createElement("label");
    //     label.setAttribute("for", datainput[i].id);
    //     label.innerHTML = datainput[i].label + "<br>";
    //     form.append(label);

    //     if (!datainput[i].options) {
    //       let input = document.createElement("input");
    //       input.setAttribute("type", datainput[i].type);
    //       input.setAttribute("id", datainput[i].id);
    //       form.append(input);
    //     }

    //     if (datainput[i].type == "submit") {
    //       let sub = document.getElementById("submitbtn");

    //       sub.innerText = "Submit";
    //       sub.style.marginBottom = "10px";
    //       sub.addEventListener("click", submitdata);
    //     }

    //     if (datainput[i].type == "dropdown" && datainput[i].options) {
    //       let select = document.createElement("select");
    //       select.setAttribute("id", datainput[i].id);
    //       form.append(select);
    //       for (j = 0; j < datainput[i].options.length; j++) {
    //         let option = document.createElement("option");
    //         option.setAttribute("value", datainput[i].options[j].value);
    //         option.setAttribute("id", datainput[i].options[j].id);
    //         option.innerHTML = datainput[i].options[j].label;
    //         select.append(option);
    //       }
    //     }
    //     form.append(document.createElement("br"));

    //     if (
    //       (datainput[i].type == "radio" || datainput[i].type == "checkbox") &&
    //       datainput[i].options
    //     ) {
    //       for (j = 0; j < datainput[i].options.length; j++) {
    //         let optionlabel = document.createElement("label");
    //         optionlabel.innerHTML = datainput[i].options[j].label;
    //         let optioninput = document.createElement("input");
    //         optioninput.setAttribute("type", datainput[i].type);
    //         optioninput.setAttribute("id", datainput[i].options[j].id);
    //         optioninput.setAttribute("name", datainput[i].options[j].name);
    //         optioninput.setAttribute("value", datainput[i].options[j].value);
    //         form.append(optioninput);
    //         form.append(optionlabel);
    //         form.append(document.createElement("br"));
    //       }
    //     }
    //   }

    // }

    function createform(ind = "") {
      // e.preventDefault();
      form.innerHTML = "";

      let editdata = {};
      console.log(ind);
      // if (ind != "") {
      eindex = ind;
      editdata = data[ind] || {};
      // console.log(editdata);
      // }
      console.log(datainput);

      for (i = 0; i < datainput.length; i++) {
        if (datainput[i].label == "Actions") {
          continue;
        }
        // console.log(editdata[datainput[i].id]);

        let label = document.createElement("label");
        label.setAttribute("for", datainput[i].id);
        label.innerHTML = datainput[i].label + "<br>";
        form.append(label);

        if (!datainput[i].options) {
          let input = document.createElement("input");
          input.setAttribute("value", editdata[datainput[i].id] || "");
          input.setAttribute("type", datainput[i].type);
          input.setAttribute("id", datainput[i].id);
          form.append(input);
        }
        // console.log(form);

        //dropdown
        if (datainput[i].type == "dropdown" && datainput[i].options) {
          let select = document.createElement("select");
          select.setAttribute("id", datainput[i].id);
          // console.log(editdata[datainput[i].id]);
          select.setAttribute("value", editdata[datainput[i].id] || "");

          form.append(select);
          for (j = 0; j < datainput[i].options.length; j++) {
            let option = document.createElement("option");

            option.setAttribute("value", datainput[i].options[j].value);
            if (editdata[datainput[i].id] == datainput[i].options[j].value)
              option.setAttribute("selected", true);

            option.setAttribute("id", datainput[i].options[j].id);
            option.innerHTML = datainput[i].options[j].label;

            select.append(option);
          }
        }

        form.append(document.createElement("br"));

        //Radio and checkbox
        if (
          (datainput[i].type == "radio" || datainput[i].type == "checkbox") &&
          datainput[i].options
        ) {
          for (j = 0; j < datainput[i].options.length; j++) {
            let optionlabel = document.createElement("label");
            optionlabel.innerHTML = datainput[i].options[j].label;
            let optioninput = document.createElement("input");
            optioninput.setAttribute("id", datainput[i].id);
            // console.log(editdata[datainput[i].id]);
            optioninput.setAttribute("value", editdata[datainput[i].id] || "");

            if (datainput[i].type == "radio" && editdata[datainput[i].id]) {
              if (editdata[datainput[i].id] == datainput[i].options[j].id) {
                optioninput.setAttribute("checked", true);
              }
            }

            if (datainput[i].type == "checkbox" && editdata[datainput[i].id]) {
              if (
                editdata[datainput[i].id].includes(datainput[i].options[j].id)
              ) {
                optioninput.setAttribute("checked", true);
              }
            }

            optioninput.setAttribute("type", datainput[i].type);
            optioninput.setAttribute("id", datainput[i].options[j].id);
            optioninput.setAttribute("name", datainput[i].options[j].name);
            optioninput.setAttribute("value", datainput[i].options[j].value);

            form.append(optioninput);
            form.append(optionlabel);
            form.append(document.createElement("br"));
          }
        }

        //Submit
        if (datainput[i].type == "submit") {
          let sub = document.getElementById("submitbtn");

          sub.innerText = "Submit";
          sub.value = "Submit";
          sub.style.marginBottom = "10px";
          sub.addEventListener("click", submitdata);
        }
      }
    }

    //table
    function createtable() {
      document.getElementById("displaytable").append(table);
      table.style.border = "1px solid black";
      let thead = document.createElement("thead");

      for (let i = 0; i < datainput.length; i++) {
        if (datainput[i].type == "submit") {
          continue;
        }
        // let tr = document.createElement("tr");
        let th = document.createElement("th");
        th.innerHTML = datainput[i].label;
        th.style.border = "1px solid black";
        thead.append(th);
        // th.append(tr);
        table.append(thead);
        table.append(tbody);
      }
      triggertable();
    }

    function deleterow(ind) {
      data.splice(ind, 1);
      triggertable();
    }

    // function editrow(ind) {
    //   let editdata = data[ind];
    //   eindex = ind;
    //   // console.log(eindex);

    //   for (let i = 0; i < datainput.length; i++) {
    //     if (datainput[i].type == "submit") {
    //       continue;
    //     }

    //     if (datainput[i].type == "radio") {
    //       let val = editdata[datainput[i].id];
    //       for (let j = 0; j < datainput[i].options.length; j++) {
    //         if (datainput[i].options[j].value == val) {
    //           document.getElementById(
    //             datainput[i].options[j].id
    //           ).checked = true;
    //         } else {
    //           document.getElementById(
    //             datainput[i].options[j].id
    //           ).checked = false;
    //         }
    //       }
    //     } else if (datainput[i].type == "checkbox") {
    //       let val = editdata[datainput[i].id].split(",");
    //       for (let j = 0; j < datainput[i].options.length; j++) {
    //         if (val.includes(datainput[i].options[j].value)) {
    //           document.getElementById(
    //             datainput[i].options[j].id
    //           ).checked = true;
    //         } else {
    //           document.getElementById(
    //             datainput[i].options[j].id
    //           ).checked = false;
    //         }
    //       }
    //     } else if (
    //       datainput[i].type == "text" ||
    //       datainput[i].type == "tel" ||
    //       datainput[i].type == "email" ||
    //       datainput[i].type == "password" ||
    //       datainput[i].type == "dropdown"
    //     ) {
    //       document.getElementById(datainput[i].id).value =
    //         editdata[datainput[i].id];
    //     }
    //   }
    //   console.log(editdata);
    //   triggertable();
    // }

    function triggertable() {
      tbody.innerHTML = "";
      // console.log(JSON.stringify(data));

      for (let i = 0; i < data.length; i++) {
        let tr = document.createElement("tr");

        for (let j = 0; j < datainput.length; j++) {
          let td = document.createElement("td");
          if (datainput[j].label == "Actions") {
            let editbtn = document.createElement("button");
            editbtn.innerHTML = "Edit";
            editbtn.style.marginRight = "5px";
            // editbtn.addEventListener("click", () => editrow(i));
            editbtn.addEventListener("click", () => createform(i));

            let deletebtn = document.createElement("button");
            deletebtn.innerHTML = "Delete";
            deletebtn.addEventListener("click", () => deleterow(i));
            td.append(editbtn);
            td.append(deletebtn);
            tr.append(td);
            tbody.append(tr);
            continue;
          }
          td.style.border = "1px solid black";
          if (datainput[j].type == "submit") {
            continue;
          }

          td.innerHTML += data[i][datainput[j].id];
          tr.append(td);
        }

        tbody.append(tr);
      }
      table.append(tbody);
    }

    function submitdata(e) {
      e.preventDefault();
      myobject = {};

      for (i = 0; i < datainput.length; i++) {
        if (datainput[i].label == "Actions") {
          continue;
        }

        if (datainput[i].type == "checkbox" || datainput[i].type == "radio") {
          myobject[datainput[i].id] = "";
          for (let z = 0; z < datainput[i].options.length; z++) {
            if (document.getElementById(datainput[i].options[z].id).checked) {
              if (myobject[datainput[i].id] != "") {
                myobject[datainput[i].id] += ",";
              }
              myobject[datainput[i].id] +=
                document.getElementById(datainput[i].options[z].id).value + "";
              document.getElementById(
                datainput[i].options[z].id
              ).checked = false;
            } else if (datainput[i].type == "dropdown") {
              myobject[datainput[i].id] = document.getElementById(
                datainput[i].id
              ).value;
            }
          }
        } else {
          let val = document.getElementById(datainput[i].id).value;
          myobject[datainput[i].id] = val;
          if (datainput[i].type == "submit") continue;
          document.getElementById(datainput[i].id).value = "";
        }
      }
      if (eindex === "") {
        data.push(myobject);
      } else {
        data[eindex] = myobject;
        eindex = "";
      }

      console.log(data);
      triggertable();
    }
    createform();
    createtable();
  </script>
</html>
